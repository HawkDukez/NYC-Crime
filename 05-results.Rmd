# Results
```{r}
library(tidyverse)
library(patchwork)
library(reshape2)
library(mi)
library(readr)
library(lubridate)
library(extracat)
library(ggplot2)
library(dplyr)
library(vcd)
library(RColorBrewer)
library(ggmosaic)
options(dplyr.summarise.inform=FALSE)
```

# Arrest data analysis of NYC from 2006 to 2021

```{r }
nyc<- read_csv('NYPD_Arrests_Data__Historic_.csv')
nyc<- nyc%>%mutate(ARREST_DATE=as.Date(nyc$ARREST_DATE,format='%m/%d/%Y'))

nyc2021<-read_csv('NYPD_Arrest_Data__Year_to_Date_.csv')
nyc2021<-nyc2021%>%mutate(ARREST_DATE=as.Date(nyc2021$ARREST_DATE,format='%m/%d/%Y'))
colnames(nyc2021)[19]<- "Lon_Lat" 
nyc<-rbind(nyc,nyc2021)

nyc<- nyc%>%mutate(ARREST_YEAR= year(nyc$ARREST_DATE))

```

## Total Number of Crimes

```{r,fig.width = 8, fig.height = 5}
options(scipen=10000)

crime_total <- count(nyc,ARREST_YEAR)
crime_total$Total <- crime_total$n

crime_total$ARREST_YEAR <- as.Date(ISOdate(crime_total$ARREST_YEAR, 1, 1))

ggplot(crime_total,aes(x=ARREST_YEAR,y=Total)) + 
  geom_bar(stat = "identity") +
  scale_x_date(limits = c(as.Date("2005-01-01"), as.Date("2022-01-01")),date_breaks = "1 year", date_labels = "%y") +
  theme_grey(16) + 
  ggtitle("Total number of Crimes in NYC over Years")
```

## Classification of Crimes

```{r}
data10 <- nyc %>% filter(year(ARREST_DATE)<2011)
data11 <- nyc %>% filter(year(ARREST_DATE)<2012&year(ARREST_DATE)>=2011)
data12 <- nyc %>% filter(year(ARREST_DATE)<2013&year(ARREST_DATE)>=2012)
data13 <- nyc %>% filter(year(ARREST_DATE)<2014&year(ARREST_DATE)>=2013)
data14 <- nyc %>% filter(year(ARREST_DATE)<2015&year(ARREST_DATE)>=2014)
data15 <- nyc %>% filter(year(ARREST_DATE)<2016&year(ARREST_DATE)>=2015)
data16 <- nyc %>% filter(year(ARREST_DATE)<2017&year(ARREST_DATE)>=2016)
data17 <- nyc %>% filter(year(ARREST_DATE)<2018&year(ARREST_DATE)>=2017)
data18 <- nyc %>% filter(year(ARREST_DATE)<2019&year(ARREST_DATE)>=2018)
data19 <- nyc %>% filter(year(ARREST_DATE)<2020&year(ARREST_DATE)>=2019)
data20 <- nyc %>% filter(year(ARREST_DATE)<2021&year(ARREST_DATE)>=2020)
data21 <- nyc %>% filter(year(ARREST_DATE)>=2021)
```

### General Category(OFNS_DESC)

```{r}
of_desc10 <- count(data10,OFNS_DESC)
of_desc10_top <- top_n(of_desc10,16)

of_desc11 <- count(data11,OFNS_DESC)
of_desc11_top <- top_n(of_desc11,16)

of_desc12 <- count(data12,OFNS_DESC)
of_desc12_top <- top_n(of_desc12,16)

of_desc13 <- count(data13,OFNS_DESC)
of_desc13_top <- top_n(of_desc13,16)

of_desc14 <- count(data14,OFNS_DESC)
of_desc14_top <- top_n(of_desc14,16)

of_desc15 <- count(data15,OFNS_DESC)
of_desc15_top <- top_n(of_desc15,16)

of_desc16 <- count(data16,OFNS_DESC)
of_desc16_top <- top_n(of_desc16,16)

of_desc17 <- count(data17,OFNS_DESC)
of_desc17_top <- top_n(of_desc17,16)

of_desc18 <- count(data18,OFNS_DESC)
of_desc18_top <- top_n(of_desc18,16)

of_desc19 <- count(data19,OFNS_DESC)
of_desc19_top <- top_n(of_desc19,16)

of_desc20 <- count(data20,OFNS_DESC)
of_desc20_top <- top_n(of_desc20,16)

of_desc21 <- count(data21,OFNS_DESC)
of_desc21_top <- top_n(of_desc21,16)
```

```{r,fig.width = 8, fig.height = 5}
most_crime2 <- intersect(of_desc10_top$OFNS_DESC, of_desc11_top$OFNS_DESC)  %>% intersect(of_desc12_top$OFNS_DESC) %>% intersect(of_desc13_top$OFNS_DESC)  %>% intersect(of_desc14_top$OFNS_DESC) %>% intersect(of_desc15_top$OFNS_DESC) %>% intersect(of_desc16_top$OFNS_DESC) %>% intersect(of_desc17_top$OFNS_DESC) %>% intersect(of_desc18_top$OFNS_DESC) %>% intersect(of_desc19_top$OFNS_DESC) %>% intersect(of_desc20_top$OFNS_DESC) %>% intersect(of_desc21_top$OFNS_DESC)

most_crime_nyc2 <- nyc %>% filter(!is.na(OFNS_DESC)) %>% 
                          filter(OFNS_DESC %in% most_crime2) %>%
                          group_by(OFNS_DESC,ARREST_YEAR) %>% 
                          summarise(Count = length(OFNS_DESC))

most_crime_nyc2$ARREST_YEAR <- as.Date(ISOdate(most_crime_nyc2$ARREST_YEAR, 1, 1))

ggplot(most_crime_nyc2, aes(ARREST_YEAR, Count, color = OFNS_DESC)) + geom_line() +
    ggtitle("The 6 Most Numerous Crimes in NYC from 2006 to 2021") +
    theme_grey(16) +
    theme(legend.title = element_blank()) + 
    labs (x = "Year", y = "Count") + 
    theme(legend.key.size = unit(.5, 'cm'),  
          legend.key.width = unit(.5, 'cm'), legend.text = element_text(size=8)) +
    scale_x_date(limits = c(as.Date("2006-01-01"), as.Date("2021-01-01")),date_breaks = "1 year", date_labels = "%y")
```
```{r,fig.width = 8, fig.height = 8}
group_year2 <- most_crime_nyc2 %>% 
             group_by(ARREST_YEAR, OFNS_DESC)

group_year2$ARREST_YEAR <- year(group_year2$ARREST_YEAR)


ggplot(data = group_year2) +
  geom_mosaic(aes(weight = Count, x = product(OFNS_DESC,ARREST_YEAR), fill=OFNS_DESC)) + 
  coord_flip() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.6, hjust=.5)) + 
  ggtitle("Percentage of Most Numerous Crimes over Years")

```
```{r}
five_year1 <- nyc %>% filter(year(ARREST_DATE)<2011&year(ARREST_DATE)>=2006)
five_year2 <- nyc %>% filter(year(ARREST_DATE)<2016&year(ARREST_DATE)>=2011)
five_year3 <- nyc %>% filter(year(ARREST_DATE)<2021&year(ARREST_DATE)>=2016)

five_year1 <- count(five_year1,OFNS_DESC)
five_year1_top <- top_n(five_year1,30)

five_year2 <- count(five_year2,OFNS_DESC)
five_year2_top <- top_n(five_year2,30)

five_year3 <- count(five_year3,OFNS_DESC)
five_year3_top <- top_n(five_year3,30)

ggplot(five_year1_top,aes(x=n,y=reorder(OFNS_DESC,n)))+
  geom_point(color = 'blue')+
  ylab("Crime")+
  xlab("Count")+
  ggtitle("30 Most Numerous Crimes From 2006 to 2010")

ggplot(five_year2_top,aes(x=n,y=reorder(OFNS_DESC,n)))+
  geom_point(color = 'blue')+
  ylab("Crime")+
  xlab("Count")+
  ggtitle("30 Most Numerous Crimes From 2011 to 2015")

ggplot(five_year3_top,aes(x=n,y=reorder(OFNS_DESC,n)))+
  geom_point(color = 'blue')+
  ylab("Crime")+
  xlab("Count")+
  ggtitle("30 Most Numerous Crimes From 2016 to 2020")

```

### Granular Category(PD_DESC)

```{r}
pd_desc10 <- count(data10,PD_DESC)
pd_desc10_top <- top_n(pd_desc10,30)

pd_desc11 <- count(data11,PD_DESC)
pd_desc11_top <- top_n(pd_desc11,30)

pd_desc12 <- count(data12,PD_DESC)
pd_desc12_top <- top_n(pd_desc12,30)

pd_desc13 <- count(data13,PD_DESC)
pd_desc13_top <- top_n(pd_desc13,30)

pd_desc14 <- count(data14,PD_DESC)
pd_desc14_top <- top_n(pd_desc14,30)

pd_desc15 <- count(data15,PD_DESC)
pd_desc15_top <- top_n(pd_desc15,30)

pd_desc16 <- count(data16,PD_DESC)
pd_desc16_top <- top_n(pd_desc16,30)

pd_desc17 <- count(data17,PD_DESC)
pd_desc17_top <- top_n(pd_desc17,30)

pd_desc18 <- count(data18,PD_DESC)
pd_desc18_top <- top_n(pd_desc18,30)

pd_desc19 <- count(data19,PD_DESC)
pd_desc19_top <- top_n(pd_desc19,30)

pd_desc20 <- count(data20,PD_DESC)
pd_desc20_top <- top_n(pd_desc20,30)

pd_desc21 <- count(data21,PD_DESC)
pd_desc21_top <- top_n(pd_desc21,30)
```

```{r,fig.width = 8, fig.height = 5}
most_crime <- intersect(pd_desc10_top$PD_DESC, pd_desc11_top$PD_DESC)  %>% intersect(pd_desc12_top$PD_DESC) %>% intersect(pd_desc13_top$PD_DESC)  %>% intersect(pd_desc14_top$PD_DESC) %>% intersect(pd_desc15_top$PD_DESC) %>% intersect(pd_desc16_top$PD_DESC) %>% intersect(pd_desc17_top$PD_DESC) %>% intersect(pd_desc18_top$PD_DESC) %>% intersect(pd_desc19_top$PD_DESC) %>% intersect(pd_desc20_top$PD_DESC) %>% intersect(pd_desc21_top$PD_DESC)

most_crime_nyc <- nyc %>% filter(!is.na(PD_DESC)) %>% 
                          filter(PD_DESC %in% most_crime) %>%
                          group_by(PD_DESC,ARREST_YEAR) %>% 
                          summarise(Count = length(PD_DESC))

most_crime_nyc$ARREST_YEAR <- as.Date(ISOdate(most_crime_nyc$ARREST_YEAR, 1, 1))

ggplot(most_crime_nyc, aes(ARREST_YEAR, Count, color = PD_DESC)) + geom_line() +
    ggtitle("The 7 Most Numerous Crimes in NYC from 2006 to 2021") +
    theme_grey(16) +
    theme(legend.title = element_blank()) + 
    labs (x = "Year", y = "Count") + 
    theme(legend.key.size = unit(.5, 'cm'),  
          legend.key.width = unit(.5, 'cm'), legend.text = element_text(size=8)) +
    scale_x_date(limits = c(as.Date("2006-01-01"), as.Date("2021-01-01")),date_breaks = "1 year", date_labels = "%y")
```

```{r,fig.width = 8, fig.height = 8}
group_year <- most_crime_nyc %>% 
             group_by(ARREST_YEAR, PD_DESC)

group_year$ARREST_YEAR <- year(group_year$ARREST_YEAR)


ggplot(data = group_year) +
  geom_mosaic(aes(weight = Count, x = product(PD_DESC,ARREST_YEAR), fill=PD_DESC)) + 
  coord_flip() + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.6, hjust=.5)) + 
  ggtitle("Percentage of Most Numerous Crimes over Years")

```


```{r}
five_year1 <- nyc %>% filter(year(ARREST_DATE)<2011&year(ARREST_DATE)>=2006)
five_year2 <- nyc %>% filter(year(ARREST_DATE)<2016&year(ARREST_DATE)>=2011)
five_year3 <- nyc %>% filter(year(ARREST_DATE)<2021&year(ARREST_DATE)>=2016)

five_year1 <- count(five_year1,PD_DESC)
five_year1_top <- top_n(five_year1,30)

five_year2 <- count(five_year2,PD_DESC)
five_year2_top <- top_n(five_year2,30)

five_year3 <- count(five_year3,PD_DESC)
five_year3_top <- top_n(five_year3,30)

ggplot(five_year1_top,aes(x=n,y=reorder(PD_DESC,n)))+
  geom_point(color = 'blue')+
  ylab("Crime")+
  xlab("Count")+
  ggtitle("30 Most Numerous Crimes From 2006 to 2010")

ggplot(five_year2_top,aes(x=n,y=reorder(PD_DESC,n)))+
  geom_point(color = 'blue')+
  ylab("Crime")+
  xlab("Count")+
  ggtitle("30 Most Numerous Crimes From 2011 to 2015")

ggplot(five_year3_top,aes(x=n,y=reorder(PD_DESC,n)))+
  geom_point(color = 'blue')+
  ylab("Crime")+
  xlab("Count")+
  ggtitle("30 Most Numerous Crimes From 2016 to 2020")

```

```{r}
knitr::kable(data.frame(column = names(nyc), count = colSums(is.na(nyc)),row.names = NULL) %>% arrange(desc(count)) %>% filter(count>0), caption = "Missing values",align = "l",full_width = F,table.attr = "style='width:30%;'")

```

```{r}
df1<-nyc%>%select(ARREST_YEAR,JURISDICTION_CODE,AGE_GROUP,PERP_SEX)
```



## Crime Geographical Analysis

In our dataset, there are some columns includes information about geographic information: \n

1) ARREST_BORO: Borough of arrest. B(Bronx), S(Staten Island), K(Brooklyn), M(Manhattan), Q(Queens)

2) ARREST_PRECINCT: Precinct where the arrest occurred

3) Latitude + Longitude : coordinates for Global Coordinate System, WGS

```{r}
library(ggmap)
library(ggplot2)
library(tidyr)
library(cowplot)
library(httr)
library(rgdal)
library(tigris)
library(dplyr)
library(broom)
```

### Borough Level Analysis

```{r}
temp_tbl_0 <- nyc %>% 
  filter(!is.na(ARREST_BORO)) %>%
  group_by(ARREST_BORO) %>%
  summarise(Count = length(ARREST_BORO)) %>%
  mutate(perc = `Count` / sum(`Count`)) %>%
  mutate(labels = scales::percent(perc)) 
scale_fill_manual(values=c("#999999", "#E69F00", "#56B4E9"))

ggplot(temp_tbl_0, aes(x = "", y = perc, fill = ARREST_BORO)) +
  geom_col() +
  coord_polar(theta = "y")+
  geom_text(aes(label = labels), position = position_stack(vjust = 0.5)) +
  ylab("Crimes Percentage") +
  xlab("borough") +
  ggtitle("Crimes Percentage for Different Boroughs") +
  scale_fill_manual(values=c( "#5499C7", "#1A5276", "#2471A3","#A9CCE3","#EAF2F8"))
  
```
\\
\\


```{r,fig.width = 8, fig.height = 5}
temp_tbl_1 <- nyc %>% 
             group_by(ARREST_YEAR, ARREST_BORO) %>%
             summarise(Freq = length(ARREST_YEAR))

vcd::mosaic(ARREST_BORO ~ ARREST_YEAR, temp_tbl_1, 
       direction = c("h", "v"), 
       highlighting_fill = rev(brewer.pal(5, 'RdBu')),
       main = "Crimes of Different Boroughs over Year ")
```
From the pie chart, we can know that the area with the most crime is Brooklyn and Staten Island has least crime numbers. Besides, we have ploted mosaic maps reflecting the proportion of crimes in different regions in different years. We found that the number of crimes in Queen is increasing, while the number of crimes in Manhattan has decreased, especially after 2015.


### Precinct Level Analysis

```{r}
temp_tbl_2 <- nyc %>% 
             filter(!is.na(ARREST_BORO)) %>%
             group_by(ARREST_BORO, ARREST_PRECINCT) %>%
             summarise(Freq = length(ARREST_BORO))
temp_tbl_2$AREA_MIX <- paste(temp_tbl_2$ARREST_BORO,temp_tbl_2$ARREST_PRECINCT)
temp_tbl_2$ARREST_PRECINCT_STR<-as.character(temp_tbl_2$ARREST_PRECINCT)
temp_tbl_2 <- temp_tbl_2[order(temp_tbl_2$Freq, decreasing = TRUE), ]

```

```{r}
b1 <- temp_tbl_2 %>% filter(ARREST_BORO == 'B') %>%
  ggplot(aes(x = reorder(ARREST_PRECINCT_STR, ARREST_PRECINCT), y = Freq)) +
  geom_bar(stat = "identity",fill = '#A9CCE3', color = '#A9CCE3') +
  ggtitle("Bronx") +
  ylab("Crimes Counts") +
  xlab("Percints")

b2 <- temp_tbl_2 %>% filter(ARREST_BORO == 'K') %>%
  ggplot(aes(x = reorder(ARREST_PRECINCT_STR, ARREST_PRECINCT), y = Freq)) +
  geom_bar(stat = "identity",fill = '#A9CCE3', color = '#A9CCE3') +
  ggtitle("Brooklyn") +
  ylab("Crimes Counts") +
  xlab("Percints")

b3 <- temp_tbl_2 %>% filter(ARREST_BORO == 'M') %>%
  ggplot(aes(x = reorder(ARREST_PRECINCT_STR, ARREST_PRECINCT), y = Freq)) +
  geom_bar(stat = "identity",fill = '#A9CCE3', color = '#A9CCE3') +
  ggtitle("Manhattan") +
  ylab("Crimes Counts") +
  xlab("Percints")

b4 <- temp_tbl_2 %>% filter(ARREST_BORO == 'Q') %>%
  ggplot(aes(x = reorder(ARREST_PRECINCT_STR, ARREST_PRECINCT), y = Freq)) +
  geom_bar(stat = "identity",fill = '#A9CCE3', color = '#A9CCE3') +
  ggtitle("Queens") +
  ylab("Crimes Counts") +
  xlab("Percints")

b5 <- temp_tbl_2 %>% filter(ARREST_BORO == 'S') %>%
  ggplot(aes(x = reorder(ARREST_PRECINCT_STR, ARREST_PRECINCT), y = Freq)) +
  geom_bar(stat = "identity",fill = '#A9CCE3', color = '#A9CCE3') +
  ggtitle("Staten Island") +
  ylab("Crimes Counts") +
  xlab("Percints")



```

```{r,fig.width = 10, fig.height = 7}
plot_grid(b1,b4,b3,b2,b5, nrow = 3, ncol = 2, align = "hv",axis = 'l' )
```
\\
\\

```{r}
ggplot(temp_tbl_2[1:20,], aes(x = reorder(AREA_MIX, Freq), y = Freq)) +
  geom_bar(stat = "identity",fill = '#2471A3', color = 'white') +
  ggtitle("Top 20 Percints with most crimes") +
  ylab("Crimes Counts") +
  xlab("Percints") +
  coord_flip()
```


From the histogram of boroughs, we can find that crime will be concentrated in a few adjacent percints especially in Bronx and Queens. For example, crime is concentrated in areas 40-52 in queens. This performance not only accords with geographical continuity, but also provides reasonable suggestions for arranging police force in the future.
Besides, We pick out the top 20 precincts with the most criminal records and found that 9 of them (almost 50%) are in Bronx, which is the most among 5 boroughs. 

### JURISDICTION_CODE

```{r}
attach(df1)
```

```{r}
df1$JURISDICTION_CODE<-as.factor(JURISDICTION_CODE)
levels(df1$JURISDICTION_CODE)[!(levels(df1$JURISDICTION_CODE)%in% c("0","1","2"))] <- "other"
```

```{r}
df1%>%
   group_by(JURISDICTION_CODE) %>%
   summarise(count=n()) %>%
   ungroup()%>%
   knitr::kable(caption = "JURISDICTION_CODE of NYC-Crime",align = "l",full_width = F,table.attr = "style='width:30%;'")
```
```{r}
ggplot(df1,aes(fct_infreq(as.factor(JURISDICTION_CODE))))+
  geom_bar(fill='lightblue')+
  labs(x='JURISDICTION_CODE')+
  ggtitle('Frequency bar chart for the JURISDICTION_CODE')+
  theme(plot.title = element_text(hjust = 0.5))
```


Jurisdiction responsible for arrest. Jurisdiction codes 0(Patrol), 1(Transit) and 2(Housing) represent NYPD whilst codes 3 and more represent non NYPD jurisdictions. Thus, we can see majority of the criminals were arrested by Patrol. 

```{r fig.width=20,fig.height=12}

df1<-df1%>%filter(!is.na(JURISDICTION_CODE))

#mosaic(JURISDICTION_CODE~ARREST_YEAR,direction = c("v", "h"),df1,highlighting_fill=brewer.pal(4,'Blues'))

vcd::mosaic(JURISDICTION_CODE~ARREST_YEAR, df1, 
       direction = c("v", "h"),
       highlighting_fill = brewer.pal(4,'Blues'))

```


```{r}
df1%>%
   group_by(JURISDICTION_CODE,ARREST_YEAR) %>%
   summarise(count=n()) %>%
   ungroup()%>%
   ggplot(aes(x=ARREST_YEAR, y=count, group=JURISDICTION_CODE,color=JURISDICTION_CODE))+
   geom_line()+
   geom_point()
```

### AGE_GROUP
```{r}
df1$AGE_GROUP<-as.factor(df1$AGE_GROUP)
levels(df1$AGE_GROUP)[!(levels(df1$AGE_GROUP)%in% c("<18","18-24","25-44","45-64","65+"))] <- "unknown"
df1$AGE_GROUP<-factor(df1$AGE_GROUP,levels=c("<18","18-24","25-44","45-64","65+","unknown"))
```


```{r}
df1%>%
   group_by(AGE_GROUP) %>%
   summarise(count=n()) %>%
   ungroup()%>%
   knitr::kable(caption = "AGE_GROUP of NYC-Crime",align = "l",full_width = F,table.attr = "style='width:30%;'")
```
```{r}
ggplot(df1,aes(factor(AGE_GROUP)))+
  geom_bar(fill='lightblue')+
  labs(x='AGE_GROUP')+
  ggtitle('Frequency bar chart for the AGE_GROUP')+
  theme(plot.title = element_text(hjust = 0.5))
```

The majority of criminals' age_group is 25-44, followed by 18-24,45-64,<18, while the minority is 65+. This is rational as the olds and underages are less stronger and they are less likely to commit crime.

```{r}
df1<-df1%>%filter(!is.na(AGE_GROUP))%>%
  mutate(AGE_GROUP=as.character(AGE_GROUP))%>%
  filter(AGE_GROUP%in%c("<18","18-24","25-44","45-64","65+"))%>%
  mutate(AGE_GROUP=as.factor(AGE_GROUP))
```

```{r fig.width=20,fig.height=12}
df1<-df1%>%filter(!is.na(AGE_GROUP))%>%filter(as.character(AGE_GROUP)%in%c("<18","18-24","25-44","45-64","65+"))
#mosaic(AGE_GROUP~ARREST_YEAR,direction = c("v", "h"),df1,highlighting_fill=brewer.pal(5,'Blues'))

vcd::mosaic(AGE_GROUP~ARREST_YEAR, df1, 
       direction = c("v", "h"), 
       highlighting_fill=brewer.pal(5,'Blues'))
```

```{r}
df1%>%
   group_by(AGE_GROUP,ARREST_YEAR) %>%
   summarise(count=n()) %>%
   ungroup()%>%
   ggplot(aes(x=ARREST_YEAR, y=count, group=AGE_GROUP,color=AGE_GROUP))+
   geom_line()+
   geom_point()
```

### PERP_SEX
```{r}
df1%>%
   group_by(PERP_SEX) %>%
   summarise(count=n()) %>%
   ungroup()%>%
   knitr::kable(caption = "PERP_SEX of NYC-Crime",align = "l",full_width = F,table.attr = "style='width:30%;'")
```
```{r}
ggplot(df1,aes(factor(PERP_SEX)))+
  geom_bar(fill='lightblue')+
  labs(x='PERP_SEX')+
  ggtitle('Frequency bar chart for the PERP_SEX')+
  theme(plot.title = element_text(hjust = 0.5))
```

Numbers of male is about four times bigger than female. According to some research, due to physiological factors (primitive gender differences), Male and female body structures are different, and naturally there will be some differences in various aspects. In terms of endocrine, men will have more eandrogens, which makes men stronger and more aggressive.Women have more estrogen in their bodies, making them less aggressive than men. Of course, because women are generally less physically powerful than men, they are more difficult to commit crimes, which will also affect the crime rate.

```{r fig.width=20,fig.height=12}
#mosaic(PERP_SEX~ARREST_YEAR,direction = c("v", "h"),df1,highlighting_fill=c(alpha("cornflowerblue",0.5),'cornflowerblue'))

vcd::mosaic(PERP_SEX~ARREST_YEAR, df1, 
       direction = c("v", "h"), 
       highlighting_fill=c(alpha("cornflowerblue",0.5),'cornflowerblue'))
```

```{r}
df1%>%
   group_by(PERP_SEX,ARREST_YEAR) %>%
   summarise(count=n()) %>%
   ungroup()%>%
   ggplot(aes(x=ARREST_YEAR, y=count, group=PERP_SEX,color=PERP_SEX))+
   geom_line()+
   geom_point()
```

```{r}
#mosaic(PERP_SEX~AGE_GROUP ,
#            df1,direction = c("v","h"),highlighting_fill=c(alpha("cornflowerblue",0.5),'cornflowerblue'))

vcd::mosaic(PERP_SEX~AGE_GROUP, df1, 
       direction = c("v","h"), 
       highlighting_fill=c(alpha("cornflowerblue",0.5),'cornflowerblue'))
```

```{r}
detach(df1)
```



### NYC crime maps


```{r}
nyc_map <- get_map(location = c(lon = -74.00, lat = 40.71), maptype = "terrain", zoom = 11)
r <- GET('http://data.beta.nyc//dataset/0ff93d2d-90ba-457c-9f7e-39e47bf2ac5f/resource/35dd04fb-81b3-479b-a074-a27a37888ce7/download/d085e2f8d0b54d4590b1e7d1f35594c1pediacitiesnycneighborhoods.geojson')
nyc_neighborhoods <- readOGR(content(r,'text'), 'OGRGeoJSON', verbose = F)
nyc_neighborhoods_df <- tidy(nyc_neighborhoods)

```


```{r}
nyc_20 <- nyc %>% 
  filter(year(ARREST_DATE) == 2020) %>%
  filter(OFNS_DESC %in% c('ASSAULT 3 & RELATED OFFENSES','FELONY ASSAULT','PETIT LARCENY',
                     'DANGEROUS DRUGS')) 

```

```{r,fig.width = 10, fig.height = 10}
ggmap(nyc_map) + 
  geom_polygon(data=nyc_neighborhoods_df, aes(x=long, y=lat, group=group), color="white", fill=NA)+
  geom_point(data=nyc_20, aes(x=Longitude,y=Latitude,color=OFNS_DESC),size=.15,alpha=.3) + 
  facet_wrap(~OFNS_DESC)

```

```{r}
nyc_18 <- nyc %>% 
  filter(year(ARREST_DATE) == 2018) %>%
  filter(OFNS_DESC %in% c('ASSAULT 3 & RELATED OFFENSES','FELONY ASSAULT','PETIT LARCENY',
                     'DANGEROUS DRUGS')) 
```

```{r, fig.width = 10, fig.height = 10}
ggmap(nyc_map) + 
  geom_polygon(data=nyc_neighborhoods_df, aes(x=long, y=lat, group=group), color="white", fill=NA)+
  geom_point(data=nyc_18, aes(x=Longitude,y=Latitude,color=OFNS_DESC),size=.15,alpha=.3) + 
  facet_wrap(~OFNS_DESC)

```


